<!DOCTYPE html>
<html>
    {{>header}}   
    <body>
        <nav class="navbar navbar-expand-sm bg-light">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="/login">Admin Login</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/">Live Graph</a>
                </li>
            </ul>
        </nav>
        <br>
        <div class="container-fluid">
            <div class="headerContainer">
                <h1>Live Noise Monitoring</h1>
            </div>

            <div class = "wait">
                <div class="row">
                    <div class="col-sm-2">
                        <h3> Available Meters...</h3>
                    </div>
                    <div class="col-sm-10">
                        <p>Meter Location (e.g. Facility Fenceline, Residence R01 etc.)</p>
                    </div>
                </div>
                <div class="row">
                    {{#each meterInfo as |item|}}
                    <div class="col-sm-2">
                        <input type="checkbox" name="choice{{@index}}" id="choice{{@index}}" value="{{{item.netBoxSerialNumber}}}">  {{item.netBoxSerialNumber}}  ({{item.meterName}})
                    </div>
                    <div class="col-sm-10">
                        <label for="text{{@index}}">Location: </label>
                        <input type="text" name="location_choice{{@index}}" id="location_choice{{@index}}" value="" disabled>  
                    </div>
                    {{/each}}
                </div>
                <p id="error_message" style="color: red"></p>
                <input type="button" id="button_update_meter_list" value="Update Meter List">

            </div> 
            <script>
                $(":checkbox").change(function(){
                    var id = $(this).attr('id');
                    $("#location_"+id).prop('disabled',!$(this).is(":checked"));   
                });
                
                $(document).ready(function(){
                    var socket = io();
                    $("#button_update_meter_list").click(function(){
                        
                        var isEmptyFlag = false;
                        var sn=[];
                        var loc=[];

                        $(":checkbox").each(function(index,value){
                            if($(this).is(":checked")){
                                var id = $(this).attr('id');
                                sn.push($(this).val());
                                loc.push($("#location_"+id).val());
                            }
                        });

                        for (var i=0; i< sn.length; i++){
                            if(loc[i]==""){
                                isEmptyFlag = true;
                                break;   
                            }
                        }

                        if(isEmptyFlag == true){
                            $("#error_message").text("Please provide location info (e.g. Facility Fenceline, Residence R01 etc.)");
                        }else{
                            $("#error_message").text("");
                            socket.emit('update_meter_list',{sn,loc});
                        }
                                 
                    });

                    socket.on('meter_list_update_successful',function(data){
                        $("#error_message").text(data);
                    });

                    socket.on('meter_list_update_failed',function(data){
                        $("#error_message").text(data);
                    });

                });
            </script>
        </div>
    </body>
</html>
