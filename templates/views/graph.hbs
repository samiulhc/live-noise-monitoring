<!DOCTYPE html>
<html>
    {{>header}}    
    <body>
        <div class="container-fluid">
            <div class="headerContainer">
                <h1>Live Noise Monitoring</h1>
            </div>
            {{#each data as |item|}}
            <div class = "graphMainContainer">
                <p> NTi Meter Location: {{item.name}}</p> 
                <p> NTi Meter Serial No: {{item.netBoxSerialNumber}} </p>
                <div class = "graphContainer" id= "graphContainer{{@index}}"></div>
            </div>  
            {{/each}}

            <script>
                function timedRefresh(timeoutPeriod) {
                    setTimeout("location.reload(true);",timeoutPeriod);
                }
                window.onload = timedRefresh(300000);   // Reload page
                
                var layout = {
                    title: 'Continuous Sound Level',
                    showlegened: 'false',
                    yaxis:{
                        title:'Sound Level (dBA)',
                        range:[30,90],
                        mirror: true,
                        showline:true
                    },
                    xaxis:{
                        title:'Time',
                        mirror: true,
                        showline:true
                    }
                }
                var graphContainer;
                var flag;
                {{#each data as |item|}}
                        graphContainer = document.getElementById("graphContainer{{@index}}");
                        flag = {{item.flag}};
                        if(flag == 1){
                        Plotly.plot(graphContainer, [{
                            x: [{{{item.data_x}}}],
                            y: [{{item.data_y}}],
                            margin: { t: 0 },
                            type:'Line'} ],layout);         
                        }else if(flag == 0){
                        Plotly.plot(graphContainer, [{
                            x: [],
                            y: [],
                            margin: { t: 0 },
                            type:'Line'} ],layout);                             
                        }
                {{/each}}
                //var interval = setInterval(function(){
                //    Plotly.extendTraces('graphContainer', { y: [[getRandomData()]] }, [0])
                //},200);
            </script>
        </div>
        
    </body>
</html>


